FROM node:15.6.0

RUN mkdir -p /home/node/app/node_modules && chown -R node:node /home/node/app

WORKDIR /home/node/app

ADD package.json yarn.lock ./

RUN yarn

COPY . .

ARG CATALOG_API_PORT
ARG CATALOG_DB_DATABASE
ARG CATALOG_DB_HOST
ARG CATALOG_DB_PORT
ARG CATALOG_DB_USER
ARG CATALOG_DB_PASS
ARG CATALOG_DEBUG_MODE

ENV CATALOG_API_PORT=${CATALOG_API_PORT} \
    CATALOG_DB_DATABASE=${CATALOG_DB_DATABASE} \
    CATALOG_DB_PORT=${CATALOG_DB_PORT} \
    CATALOG_DB_HOST=${CATALOG_DB_HOST} \
    CATALOG_DB_USER=${CATALOG_DB_USER} \
    CATALOG_DB_PASS=${CATALOG_DB_PASS} \
    CATALOG_DEBUG_MODE=${CATALOG_DEBUG_MODE}

expose 5000
CMD ["node", "./src/index.js"]
