FROM node:15.6.0

RUN mkdir -p /home/node/app/node_modules && chown -R node:node /home/node/app

WORKDIR /home/node/app

ADD package.json yarn.lock ./

RUN yarn

COPY . .

ARG REC_API_PORT
ARG RECOMM_URL
ARG RECOMM_MOST_POPULAR_PATH
ARG RECOMM_PRICE_REDUCTION_PATH
ARG CATALOG_HOST
ARG CATALOG_API_PORT
ARG CATALOG_PROTOCOL
ARG RECOMM_DEBUG_MODE
ARG CATALOG_PRODUCT_ROUTE

ENV REC_API_PORT=${REC_API_PORT} \
    RECOMM_URL=${RECOMM_URL} \
    RECOMM_MOST_POPULAR_PATH=${RECOMM_MOST_POPULAR_PATH} \
    RECOMM_PRICE_REDUCTION_PATH=${RECOMM_PRICE_REDUCTION_PATH} \
    CATALOG_HOST=${CATALOG_HOST} \
    CATALOG_API_PORT=${CATALOG_API_PORT} \
    CATALOG_PROTOCOL=${CATALOG_PROTOCOL} \
    DEBUG_MODE=${DEBUG_MODE} \
    RECOMM_DEBUG_MODE=${RECOMM_DEBUG_MODE} \
    CATALOG_PRODUCT_ROUTE=${CATALOG_PRODUCT_ROUTE}

expose 5051
CMD ["node", "./src/index.js"]
